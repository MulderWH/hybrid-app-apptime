<?xml version="1.0" encoding="UTF-8" ?>
<widget xmlns = "http://www.w3.org/ns/widgets"
        xmlns:gap = "http://phonegap.com/ns/1.0"
        id        = "{{identifier}}"
        version   = "{{version}}" 
        android-versionCode = "{{android-versionCode}}" >
    <!-- WM: force the android-versionCode to make sure we have a higher version code than production APKs, see: -->
    <!-- https://medium.com/@mideeshp/shadowed-by-production-to-be-available-to-all-testers-apks-on-this-track-need-to-have-a-higher-fd22a98cea8 -->

    <name>{{name}}</name>

    <description>{{description}}</description>

    <!--
    Current latest and default version
    Platform versions don't follow a common version number anymore
    (see: http://phonegap.com/blog/2015/06/16/phonegap-updated-on-build/).
    Instead, Phonegap Build derives the platform versions from the CLI
    defaults.
    -->
    <preference name="phonegap-version" value="cli-7.1.0" />

    <!-- allow assets to be loaded and open links in the app itself, see: http://phonegap.com/blog/2012/03/20/access-tags/ -->
    <!-- Issue 204079: Allow retrieval of any resource. Custom widgets can point to anything. -->
    <access origin="*" />
    <allow-navigation href="*://*.mendix.com/*" />
    <allow-navigation href="*://*.mendixcloud.com/*" />
    <allow-navigation href="*://*.mxapp.io/*" />
    <allow-navigation href="about:blank" />
    
    <!-- WM: click-to-call links fix, see https://forum.mendixcloud.com/link/questions/88197-->
    <allow-intent href="tel:*" />
    <allow-intent href="sms:*" />  
    <allow-intent href="mailto:*" /> 
    <!-- WM: allow videos and assets to be loaded and open links in the app itself -->
    <allow-navigation href="*://*.vimeo.com/*"/>
    <allow-navigation href="*://*.youtube.com/*"/>
    <allow-navigation href="*://*.apptime.nl/*"/>
    <allow-navigation href="*://upload.satisfactor.net/*"/>

    <!-- Force the default architecture for Android to ARM -->
    <!-- WM:  disabled the screenshot plugin because its not used and shows warning  in console
    <plugin name="com.darktalker.cordova.screenshot" source="npm" spec="0.1.6" /> -->
    <plugin name="com.telerik.plugins.nativepagetransitions" source="npm" spec="0.6.5" />
    <plugin name="cordova-build-architecture" source="git" spec="https://github.com/MBuchalik/cordova-build-architecture.git#v1.0.3" />
    <plugin name="cordova-plugin-actionsheet" source="npm" spec="2.3.3" />
    <plugin name="cordova-plugin-android-permissions" source="npm" spec="0.10.0" />
    <plugin name="cordova-plugin-app-version" source="npm" spec="0.1.8" />
    <plugin name="cordova-plugin-battery-status" source="npm" spec="1.1.2" />
    <plugin name="cordova-plugin-cookieemperor" spec="https://github.com/rtk/cordova-cookie-emperor.git" />
    <plugin name="cordova-plugin-device" source="npm" spec="1.1.2" />
    <!-- WM: disable the plugins, because they are not used and require permissions -->
    <!-- WM: <plugin name="cordova-plugin-device-motion" source="npm" spec="1.2.1" /> -->
    <!-- WM: <plugin name="cordova-plugin-device-orientation" source="npm" spec="1.0.3" /> -->
    <plugin name="cordova-plugin-dialogs" source="npm" spec="1.2.1" />
    <plugin name="cordova-plugin-file" source="npm" spec="4.2.0" />
    <plugin name="cordova-plugin-file-opener2" source="npm" spec="2.0.19" />
    <plugin name="cordova-plugin-file-transfer" source="npm" spec="1.5.1" />
    <plugin name="cordova-plugin-globalization" source="npm" spec="1.0.3" />
    <plugin name="cordova-plugin-inappbrowser" source="npm" spec="3.0.0" />
    <plugin name="cordova-plugin-network-information" source="npm" spec="1.2.1" />
    <plugin name="cordova-plugin-secure-storage" source="npm" spec="2.4.0" />
    <plugin name="cordova-plugin-spinner" source="npm" spec="1.1.0" />
    <!-- WM: upgrade splash screen for iphone x support-->
    <plugin name="cordova-plugin-splashscreen" source="npm" spec="5.0.2" />
    <!-- WM: upgrade statusbar for iphone x support-->
    <plugin name="cordova-plugin-statusbar" source="npm" spec="2.4.2" />
    <plugin name="cordova-plugin-vibration" source="npm" spec="2.1.1" />
    <!-- WM: <plugin name="cordova-plugin-x-socialsharing" source="npm" version="5.0.11"/> -->
    <plugin name="cordova-plugin-zip" source="npm" spec="3.1.0" />
    <plugin name="cordova-plugin-whitelist" source="npm" spec="1.2.2" />
    <plugin name="cordova-sqlite-storage-pgb" source="git" spec="https://github.com/mendix/Cordova-sqlite-storage-pgb.git#storage-master" />
    <!-- WM:  disabled the launchnavigator plugin because its not used
    <plugin name="uk.co.workingedge.phonegap.plugin.launchnavigator" source="npm" version="2.9.11"/> -->

    {{#permissions.calendar}}
        <plugin name="cordova-plugin-calendar" source="npm" spec="4.5.5">
            <param name="CALENDAR_USAGE_DESCRIPTION" value="This app needs to access your calendar" />
        </plugin>
    {{/permissions.calendar}}

    {{#permissions.camera}}
        {{#permissions.photoLibrary}}
            <plugin name="cordova-plugin-camera" source="npm" spec="4.0.3">
                <param name="CAMERA_USAGE_DESCRIPTION" value="This app needs to access your camera to create a profile picture" />
                <param name="PHOTOLIBRARY_USAGE_DESCRIPTION" value="This app needs to access your photo library to create a profile picture" />
            </plugin>
        {{/permissions.photoLibrary}}
    {{/permissions.camera}}

    {{#permissions.contacts}}
        <plugin name="cordova-plugin-contacts" source="npm" spec="2.3.0">
            <param name="CONTACTS_USAGE_DESCRIPTION" value="This app needs to access your contacts" />
        </plugin>
    {{/permissions.contacts}}

    {{#permissions.camera}}
        {{#permissions.photoLibrary}}
            {{#permissions.microphone}}
                <plugin name="cordova-plugin-media-capture" source="npm" spec="1.4.2">
                    <param name="CAMERA_USAGE_DESCRIPTION" value="This app needs to access your camera" />
                    <param name="MICROPHONE_USAGE_DESCRIPTION" value="This app needs to access your microphone" />
                    <param name="PHOTOLIBRARY_USAGE_DESCRIPTION" value="This app needs to access your photo library" />
                </plugin>
            {{/permissions.microphone}}
        {{/permissions.photoLibrary}}
    {{/permissions.camera}}

    {{#permissions.camera}}
        <!-- WM: disabled the barcodescanner plugin because it's not used and require permissions  
        <plugin name="phonegap-plugin-barcodescanner" source="npm" spec="8.0.0" >
            <param name="CAMERA_USAGE_DESCRIPTION" value="This app needs to access your camera" />
        </plugin> -->
    {{/permissions.camera}}

    {{#permissions.geoLocation}}
        <plugin name="cordova-plugin-geolocation" source="npm" spec="2.2.0">
            <param name="GEOLOCATION_USAGE_DESCRIPTION" value="This app needs to access your location" />
        </plugin>
    {{/permissions.geoLocation}}

    {{#permissions.universalLinks}}
        <!-- WM: universal links plugin to open this app using hyperlinks in other apps i.e. mail-->
        <plugin name="cordova-universal-links-plugin" source="git" spec="https://github.com/flipflopapp/cordova-universal-links-plugin.git"/>
        <universal-links>
            <host name="accp.apptime.nl" scheme="https">
                <path url="/link/*"/>
            </host>
            <host name="prod.apptime.nl" scheme="https">
                <path url="/link/*"/>
            </host>
        </universal-links>
    {{/permissions.universalLinks}}

    {{#permissions.microphone}}
        <plugin name="cordova-plugin-media" source="npm" spec="2.3.0" />
    {{/permissions.microphone}}

    {{#permissions.push}}
        <plugin name="phonegap-plugin-push" source="npm" spec="1.5.3" />
    {{/permissions.push}}

    {{#iosEnabled}}
        <!-- On iOS, the statusbar is transparent by default and is drawn over the top of our app. -->

        <!-- WM: make status bar overlay and change default color -->
        <preference name="StatusBarOverlaysWebView" value="true" />
        <preference name="StatusBarBackgroundColor" value="#FFFFFF" />
        <preference name="StatusBarStyle" value="default" />

        <preference name="DisallowOverscroll" value="true" />

        <preference name="webviewbounce" value="false" />

        <!-- Set proper defaults for `cordova.file.dataDirectory`. -->
        <preference name="iosPersistentFileLocation" value="Library" />

        <!-- Set proper keyboard action for Apple device. -->
        <preference name="KeyboardDisplayRequiresUserAction" value="false" />

        <!-- Disable backup to iCloud on iOS. -->
        <preference name="BackupWebStorage" value="none" />

        <!-- Disable WKWebView on iOS 
        <feature name="CDVWKWebViewEngine">
            <param name="ios-package" value="CDVWKWebViewEngine" />
        </feature>

        <preference name="CordovaWebViewEngine" value="CDVWKWebViewEngine" />

        <preference name="KeyboardDisplayRequiresUserAction" value="false" />

        <plugin name="cordova-plugin-wkwebview-engine-nextgen" source="npm" spec="^1.1.0" />
        -->

        <platform name="ios">
            {{#iosImages}}
                <{{{tag}}} src="{{{filename}}}" width="{{{width}}}" height="{{{height}}}" />
            {{/iosImages}}
        </platform>
    {{/iosEnabled}}

    {{#androidEnabled}}
        <!-- The gradle build tool is required for the phonegap-plugin-push -->
        <preference name="android-build-tool" value="gradle" />

        {{#options.architecture}}
            <preference name="buildArchitecture" value="{{.}}" />
        {{/options.architecture}}
        <!-- WM: make sure the app is not launched multiple times-->
        <preference name="AndroidLaunchMode" value="singleInstance" />

        <plugin name="cordova-plugin-whitelist" source="npm" spec="1.2.2" />
        <plugin name="cordova-plugin-android-permissions" source="npm" version="0.10.0" />
        <plugin name="cordova-android-support-gradle-release" source="npm" version="1.2.0">
            <variable name="ANDROID_SUPPORT_VERSION" value="27.0.0" />
        </plugin>

        <preference name="android-minSdkVersion" value="19" />

        {{^crosswalkEnabled}}
        <preference name="android-targetSdkVersion" value="27" />
        {{/crosswalkEnabled}}

        {{#crosswalkEnabled}}
        <preference name="android-targetSdkVersion" value="23" />

        <preference name="CrosswalkAnimatable" value="true" />
        <preference name="xwalkMultipleApk" value="true" />

        <plugin name="cordova-plugin-crosswalk-webview" source="npm" spec="2.3.0" />
        <plugin name="com.crosswalk.cookies" spec="https://github.com/dokoto/crosswalk-cookies.git" />
        {{/crosswalkEnabled}}

        <platform name="android">
            {{#androidImages}}
                <!-- Icon definitions - for more details: http://developer.android.com/guide/topics/resources/providing-resources.html -->
                {{#density}}
                    <{{{tag}}} src="{{{filename}}}" density="{{{density}}}"/>
                {{/density}}
                {{#qualifier}}
                    <{{{tag}}} src="{{{filename}}}" density="{{{qualifier}}}"/>
                {{/qualifier}}
            {{/androidImages}}
        </platform>
    {{/androidEnabled}}

    <splash src="res/android/screen-xxxhdpi-portrait.png" />

    {{{customConfiguration}}}
    <!-- WM: Set to false to hide the splash-screen spinner. -->  
    <preference name="ShowSplashScreenSpinner" value="false"/>
    <preference name="SplashScreenDelay" value="20000" />
    <preference name="FadeSplashScreenDuration" value="1000" />
</widget>
